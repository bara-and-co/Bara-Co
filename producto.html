<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="pageTitle">Producto · Bara & Co</title>
  <meta name="description" id="metaDesc" content="Indumentaria exclusiva · Bara & Co"/>
  <meta property="og:type" content="product"/>
  <meta property="og:site_name" content="Bara & Co"/>
  <meta property="og:title" id="ogTitle" content="Bara & Co"/>
  <meta property="og:description" id="ogDesc" content="Indumentaria exclusiva · Bara & Co"/>
  <meta property="og:image" id="ogImage" content=""/>
  <meta property="og:url" id="ogUrl" content=""/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" id="twTitle" content="Bara & Co"/>
  <meta name="twitter:description" id="twDesc" content="Indumentaria exclusiva · Bara & Co"/>
  <meta name="twitter:image" id="twImage" content=""/>

  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    /* ─── TOKENS ─────────────────────────────────────── */
    :root {
      --bg:       #0a0a08;
      --surface:  #111110;
      --surface2: #181816;
      --border:   rgba(255,255,255,.06);
      --border2:  rgba(255,255,255,.1);
      --text:     #ede9e1;
      --muted:    #6b6760;
      --muted2:   #9a9591;
      --accent:   #c9a96e;
      --adk:      #a07e48;
      --red:      #c0392b;
      --green:    #25d366;
      --serif:    'Cormorant Garamond', Georgia, serif;
      --sans:     'DM Sans', sans-serif;
      --ease:     cubic-bezier(.16,1,.3,1);
      --ease2:    cubic-bezier(.4,0,.2,1);
    }

    /* ─── RESET ──────────────────────────────────────── */
    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
    html { scroll-behavior:smooth; }
    body {
      background:var(--bg); color:var(--text);
      font-family:var(--sans); font-size:14px; line-height:1.6;
      padding-top:68px; overflow-x:hidden;
    }
    a { color:inherit; text-decoration:none; }
    img { display:block; width:100%; height:100%; object-fit:cover; }
    button { font-family:var(--sans); cursor:pointer; }

    /* ─── HEADER ──────────────────────────────────────── */
    #header {
      position:fixed; top:0; left:0; right:0; z-index:500;
      height:68px; display:flex; align-items:center;
      justify-content:space-between; padding:0 40px;
      background:rgba(10,10,8,.9); backdrop-filter:blur(24px);
      border-bottom:1px solid var(--border);
      transition:border-color .3s;
    }
    #header.scrolled { border-color:rgba(255,255,255,.1); }
    .logo-img { height:56px; width:auto; object-fit:contain; }
    .header-nav ul { display:flex; gap:32px; list-style:none; }
    .header-nav a {
      font-size:10.5px; font-weight:500; letter-spacing:.14em;
      text-transform:uppercase; color:var(--muted);
      position:relative; transition:color .25s; padding-bottom:2px;
    }
    .header-nav a::after {
      content:''; position:absolute; bottom:0; left:0; right:0;
      height:1px; background:var(--accent);
      transform:scaleX(0); transform-origin:left;
      transition:transform .3s var(--ease);
    }
    .header-nav a:hover, .header-nav a.active { color:var(--text); }
    .header-nav a:hover::after, .header-nav a.active::after { transform:scaleX(1); }
    .header-right { display:flex; align-items:center; gap:18px; }
    .header-icon-btn {
      background:none; border:none; color:var(--muted);
      font-size:15px; transition:color .25s; position:relative;
    }
    .header-icon-btn:hover { color:var(--accent); }
    .cart-badge {
      position:absolute; top:-6px; right:-8px;
      background:var(--accent); color:var(--bg);
      font-size:8.5px; font-weight:700; min-width:16px; height:16px;
      border-radius:8px; display:none; place-items:center; padding:0 3px;
    }
    .cart-badge.on { display:grid; }

    /* ─── BREADCRUMB ─────────────────────────────────── */
    .breadcrumb {
      padding:20px 40px 0;
      font-size:11px; color:var(--muted); letter-spacing:.04em;
      display:flex; align-items:center; gap:6px;
    }
    .breadcrumb a { transition:color .2s; }
    .breadcrumb a:hover { color:var(--accent); }
    .breadcrumb i { font-size:8px; color:var(--muted); }

    /* ─── PRODUCT PAGE LAYOUT ─────────────────────────── */
    .product-page {
      max-width:1320px; margin:0 auto;
      padding:32px 40px 100px;
    }

    .product-columns {
      display:grid;
      grid-template-columns: 56% 1fr;
      gap:56px;
      align-items:start;
      margin-bottom:100px;
    }

    /* ─── GALLERY ──────────────────────────────────────── */
    .gallery {
      position:sticky; top:88px;
    }

    .gallery-layout {
      display:grid;
      grid-template-columns:80px 1fr;
      gap:10px;
    }

    /* Thumbnails: columna lateral */
    .thumbnails {
      display:flex; flex-direction:column; gap:8px;
      overflow-y:auto; max-height:600px;
      scrollbar-width:thin; scrollbar-color:var(--accent) transparent;
    }
    .thumbnails::-webkit-scrollbar { width:3px; }
    .thumbnails::-webkit-scrollbar-thumb { background:var(--accent); border-radius:2px; }

    .thumb {
      width:78px; height:98px; flex-shrink:0;
      border:1.5px solid transparent;
      cursor:pointer; overflow:hidden;
      transition:border-color .2s, opacity .2s;
      background:var(--surface2); opacity:.55;
    }
    .thumb:hover { opacity:.85; }
    .thumb.active { border-color:var(--accent); opacity:1; }
    .thumb img { width:100%; height:100%; object-fit:cover; }

    /* Imagen principal */
    .main-image {
      position:relative;
      aspect-ratio:3/4;
      overflow:hidden;
      background:var(--surface2);
      cursor:zoom-in;
    }
    .main-image img {
      width:100%; height:100%; object-fit:cover;
      transition:transform .5s var(--ease);
    }
    .main-image:hover img { transform:scale(1.03); }

    /* Badges sobre imagen */
    .img-badges {
      position:absolute; top:14px; left:14px; z-index:3;
      display:flex; flex-direction:column; gap:6px;
    }
    .img-badge {
      font-size:8.5px; font-weight:700; letter-spacing:.12em;
      text-transform:uppercase; padding:4px 10px;
    }
    .badge-sale { background:var(--red); color:#fff; }
    .badge-new  { background:var(--accent); color:var(--bg); }

    /* Zoom hint */
    .zoom-hint {
      position:absolute; bottom:14px; right:14px; z-index:3;
      font-size:10px; color:var(--muted2); letter-spacing:.06em;
      display:flex; align-items:center; gap:5px;
      background:rgba(10,10,8,.6); padding:5px 10px; backdrop-filter:blur(4px);
    }
    .zoom-hint i { font-size:11px; }

    /* Dots navegación mobile */
    .gallery-dots {
      display:none;
      justify-content:center; gap:6px; margin-top:12px;
    }
    .g-dot {
      width:6px; height:6px; border-radius:50%;
      background:var(--border2); transition:background .2s; border:none;
    }
    .g-dot.active { background:var(--accent); }

    /* ─── PRODUCT INFO ──────────────────────────────────── */
    .product-info { padding:4px 0; }

    /* Categoría + Wishlist */
    .info-top {
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom:10px;
    }
    .product-category {
      font-size:10px; font-weight:600; letter-spacing:.2em;
      text-transform:uppercase; color:var(--accent);
    }
    .wishlist-btn {
      background:none; border:1px solid var(--border2); color:var(--muted);
      width:34px; height:34px; border-radius:50%; font-size:14px;
      transition:all .25s; display:grid; place-items:center;
    }
    .wishlist-btn:hover, .wishlist-btn.active {
      border-color:var(--red); color:var(--red);
    }
    .wishlist-btn.active i { font-weight:900; }

    /* Título y precio */
    .product-title {
      font-family:var(--serif); font-size:clamp(32px,4vw,46px);
      font-weight:400; line-height:1.05; margin-bottom:16px;
      letter-spacing:-.01em;
    }

    .price-block { display:flex; align-items:baseline; gap:12px; margin-bottom:6px; }
    .price-current {
      font-family:var(--serif); font-size:32px; font-weight:500; color:var(--accent);
    }
    .price-before {
      font-size:16px; color:var(--muted); text-decoration:line-through;
    }
    .discount-pill {
      font-size:11px; font-weight:700; padding:3px 9px;
      background:rgba(192,57,43,.15); color:#e07b6a;
      border:1px solid rgba(192,57,43,.25); border-radius:20px;
    }

    /* Stock urgency */
    .stock-urgency {
      display:none; align-items:center; gap:7px;
      font-size:12px; font-weight:600; color:#e07b39;
      margin-bottom:18px; letter-spacing:.04em;
    }
    .stock-urgency.show { display:flex; }
    .stock-urgency i { font-size:13px; }

    /* Divider */
    .divider {
      height:1px; background:var(--border); margin:20px 0;
    }

    /* Descripción */
    .product-description {
      font-size:14px; color:var(--muted2); line-height:1.9;
      margin-bottom:0;
    }

    /* Composición */
    .material-block {
      display:none;
    }
    .material-title {
      font-size:9.5px; font-weight:600; letter-spacing:.18em;
      text-transform:uppercase; color:var(--muted); margin-bottom:10px;
    }
    .material-tags { display:flex; flex-wrap:wrap; gap:6px; margin-bottom:12px; }
    .material-tag {
      font-size:11.5px; color:var(--text);
      background:rgba(255,255,255,.04); border:1px solid var(--border2);
      padding:5px 12px; border-radius:20px;
      display:inline-flex; align-items:center; gap:6px;
    }
    .material-tag i { color:var(--accent); font-size:10px; }
    .care-icons { display:flex; gap:18px; flex-wrap:wrap; }
    .care-icon {
      display:flex; flex-direction:column; align-items:center;
      gap:5px; font-size:9.5px; color:var(--muted); min-width:40px;
    }
    .care-icon i { font-size:20px; color:rgba(201,169,110,.55); }

    /* ─── SELECTOR DE TALLE ────────────────────────────── */
    .section-label {
      font-size:10px; font-weight:600; letter-spacing:.18em;
      text-transform:uppercase; color:var(--muted);
      margin-bottom:12px;
      display:flex; align-items:center; justify-content:space-between;
    }
    .selected-indicator {
      font-size:12px; font-weight:500; color:var(--text); letter-spacing:0;
      text-transform:none;
    }
    .size-guide-link {
      font-size:10px; font-weight:400; color:var(--accent);
      letter-spacing:.04em; text-transform:none;
      text-decoration:underline; text-underline-offset:3px; cursor:pointer;
      transition:color .2s;
    }
    .size-guide-link:hover { color:var(--adk); }

    .size-options { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:8px; }
    .size-btn {
      position:relative;
      min-width:56px; height:56px; padding:0 14px;
      border:1.5px solid var(--border2); background:transparent;
      color:var(--text); font-size:13px; font-weight:500;
      transition:all .2s; overflow:visible;
      display:flex; flex-direction:column; align-items:center; justify-content:center; gap:2px;
    }
    .size-btn:hover:not(.out-of-stock) { border-color:var(--accent); color:var(--accent); }
    .size-btn.active {
      background:var(--accent); border-color:var(--accent);
      color:var(--bg); font-weight:600;
    }
    .size-btn.active .size-stock-info { color:rgba(0,0,0,.55); }
    .size-btn.out-of-stock {
      opacity:.28; cursor:not-allowed;
      text-decoration:line-through;
    }
    .size-btn.stock-low:not(.out-of-stock) { border-color:rgba(224,123,57,.55); }
    .size-btn.stock-low:not(.out-of-stock):not(.active) { color:#e07b39; }

    /* Info de stock debajo del nombre del talle */
    .size-stock-info {
      font-size:8.5px; font-weight:600; letter-spacing:.04em; line-height:1;
      color:var(--muted); white-space:nowrap;
    }
    .size-stock-info.sok   { color:#4db87a; }
    .size-stock-info.slow  { color:#e07b39; }
    .size-stock-info.sout  { color:var(--red); }

    /* Resumen de stock disponible total */
    .size-stock-summary {
      font-size:11px; color:var(--muted2); margin-bottom:18px;
      display:flex; align-items:center; gap:6px;
    }
    .size-stock-summary .dot { width:6px; height:6px; border-radius:50%; background:var(--muted); }
    .size-stock-summary .dot.ok   { background:#4db87a; }
    .size-stock-summary .dot.low  { background:#e07b39; }

    #sizeError {
      font-size:12px; color:#e07b6a; margin-top:-14px;
      margin-bottom:16px; display:flex; align-items:center; gap:6px;
      min-height:18px;
    }

    /* ─── SELECTOR DE COLOR ───────────────────────────── */
    #colorSection { margin-bottom:22px; }
    .color-options { display:flex; gap:10px; flex-wrap:wrap; }
    .color-btn {
      width:34px; height:34px; border-radius:50%;
      border:2.5px solid transparent; cursor:pointer;
      transition:border-color .2s, transform .2s; outline:3px solid transparent;
      outline-offset:2px;
    }
    .color-btn:hover { transform:scale(1.1); }
    .color-btn.active { outline-color:var(--accent); border-color:var(--bg); }

    /* ─── BOTONES DE ACCIÓN ────────────────────────────── */
    .action-buttons { display:flex; gap:10px; margin-bottom:16px; }

    .btn-add {
      flex:1; height:52px;
      background:var(--accent); color:var(--bg);
      border:none; font-size:11.5px; font-weight:700;
      letter-spacing:.16em; text-transform:uppercase;
      display:flex; align-items:center; justify-content:center; gap:9px;
      transition:background .25s, transform .2s;
    }
    .btn-add:hover { background:var(--adk); transform:translateY(-1px); }
    .btn-add:active { transform:translateY(0); }

    .btn-wa {
      height:52px; width:52px; flex-shrink:0;
      background:transparent; border:1.5px solid var(--border2); color:var(--text);
      font-size:18px; display:grid; place-items:center;
      transition:all .25s;
    }
    .btn-wa:hover {
      background:rgba(37,211,102,.1); border-color:#25d366; color:#25d366;
    }

    /* ─── BENEFICIOS (3 columnas) ─────────────────────── */
    .benefits {
      display:grid; grid-template-columns:repeat(3,1fr); gap:1px;
      background:var(--border); border:1px solid var(--border);
      margin-bottom:16px;
    }
    .benefit-item {
      background:var(--surface); padding:14px 10px;
      display:flex; flex-direction:column; align-items:center;
      gap:6px; text-align:center;
    }
    .benefit-item i { font-size:16px; color:var(--accent); }
    .benefit-label { font-size:10.5px; font-weight:500; color:var(--text); }
    .benefit-sub { font-size:9.5px; color:var(--muted); letter-spacing:.03em; }

    /* ─── MEDIOS DE PAGO ──────────────────────────────── */
    .payment-block {
      padding:14px 16px;
      background:var(--surface); border:1px solid var(--border);
      margin-bottom:16px;
    }
    .payment-label {
      font-size:9.5px; font-weight:600; letter-spacing:.14em;
      text-transform:uppercase; color:var(--muted); margin-bottom:10px;
    }
    .payment-row { display:flex; align-items:center; gap:6px; flex-wrap:wrap; }
    .pay-pill {
      height:24px; padding:0 9px; border-radius:3px;
      font-size:10px; font-weight:700; letter-spacing:.03em;
      display:inline-flex; align-items:center;
    }
    .pay-visa  { background:#1a1f71; color:#fff; }
    .pay-mc    { background:#eb001b; color:#fff; }
    .pay-mc span { color:#f79e1b; }
    .pay-amex  { background:#016fd0; color:#fff; }
    .pay-mp    { background:#009ee3; color:#fff; }
    .pay-ssl {
      display:inline-flex; align-items:center; gap:4px;
      font-size:10px; color:var(--muted);
      border:1px solid var(--border2); padding:2px 8px; border-radius:3px;
      margin-left:auto;
    }
    .pay-ssl i { color:#4db87a; font-size:11px; }

    /* ─── ACORDEÓN POLÍTICAS ─────────────────────────── */
    .policy-accordion {
      border:1px solid var(--border); overflow:hidden;
    }
    .policy-item { border-bottom:1px solid var(--border); }
    .policy-item:last-child { border-bottom:none; }

    .policy-trigger {
      width:100%; background:none; border:none; color:var(--text);
      padding:15px 18px;
      display:flex; align-items:center; justify-content:space-between;
      font-size:11px; font-weight:600; letter-spacing:.1em; text-transform:uppercase;
      cursor:pointer; transition:background .2s, color .2s;
    }
    .policy-trigger:hover { background:rgba(255,255,255,.02); color:var(--accent); }
    .policy-trigger-left { display:flex; align-items:center; gap:10px; }
    .policy-trigger-left i { color:var(--accent); font-size:13px; }
    .policy-chevron { font-size:10px; color:var(--muted); transition:transform .3s var(--ease); }
    .policy-item.open .policy-chevron { transform:rotate(180deg); }

    .policy-body { max-height:0; overflow:hidden; transition:max-height .4s var(--ease); }
    .policy-item.open .policy-body { max-height:400px; }
    .policy-content {
      padding:0 18px 16px; font-size:13px; color:var(--muted2); line-height:1.85;
    }
    .policy-content strong { color:var(--text); font-weight:500; }
    .policy-content ul { list-style:none; margin-top:8px; }
    .policy-content ul li { padding:2px 0; display:flex; gap:8px; }
    .policy-content ul li::before { content:'→'; color:var(--accent); flex-shrink:0; }

    /* ─── SECCIÓN RELACIONADOS / CROSSELL ──────────────── */
    .products-section {
      padding-top:64px;
      border-top:1px solid var(--border);
      margin-bottom:64px;
    }
    .section-header {
      display:flex; align-items:baseline; justify-content:space-between;
      margin-bottom:32px;
    }
    .section-header h3 {
      font-family:var(--serif); font-size:clamp(22px,3vw,32px); font-weight:400;
    }
    .section-header a {
      font-size:11px; font-weight:500; color:var(--accent);
      letter-spacing:.1em; text-transform:uppercase;
      text-decoration:underline; text-underline-offset:4px; transition:color .2s;
    }
    .section-header a:hover { color:var(--adk); }

    /* Grid de productos */
    .products-grid {
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:2px;
    }
    .prod-card {
      background:var(--surface); cursor:pointer;
      position:relative; overflow:hidden;
      transition:transform .35s var(--ease);
    }
    .prod-card:hover { transform:translateY(-5px); }

    .prod-card-img {
      position:relative; aspect-ratio:3/4; overflow:hidden;
    }
    .prod-card-img img { width:100%; height:100%; object-fit:cover; transition:transform .5s var(--ease); }
    .prod-card:hover .prod-card-img img { transform:scale(1.04); }

    /* Overlay CTA */
    .prod-card-overlay {
      position:absolute; inset:0;
      background:rgba(10,10,8,.5);
      display:flex; align-items:center; justify-content:center;
      opacity:0; transition:opacity .25s;
    }
    .prod-card:hover .prod-card-overlay { opacity:1; }
    .overlay-add {
      background:#fff; color:var(--bg); border:none;
      font-size:9.5px; font-weight:700; letter-spacing:.16em; text-transform:uppercase;
      padding:11px 20px; display:flex; align-items:center; gap:7px;
      transform:translateY(10px); transition:transform .3s var(--ease), background .2s;
    }
    .prod-card:hover .overlay-add { transform:translateY(0); }
    .overlay-add:hover { background:var(--accent); }

    /* Badges */
    .prod-badge {
      position:absolute; top:10px; left:10px; z-index:2;
      font-size:8px; font-weight:700; letter-spacing:.1em; text-transform:uppercase;
      padding:3px 9px;
    }
    .prod-badge-cat { background:var(--accent); color:var(--bg); }
    .prod-badge-sale { background:var(--red); color:#fff; top:10px; left:auto; right:10px; }

    .prod-card-info { padding:12px 12px 16px; }
    .prod-cat { font-size:8px; letter-spacing:.18em; text-transform:uppercase; color:var(--muted); margin-bottom:3px; }
    .prod-name { font-family:var(--serif); font-size:15px; line-height:1.2; margin-bottom:5px; }
    .prod-price { color:var(--accent); font-size:13px; }
    .prod-price del { color:var(--muted); font-size:11px; margin-right:4px; }

    /* ─── MODAL IMAGEN ────────────────────────────────── */
    .image-modal {
      position:fixed; inset:0; background:rgba(0,0,0,.96);
      z-index:1000; display:none; place-items:center;
    }
    .image-modal.open { display:grid; }
    .modal-img { max-width:90vw; max-height:90vh; object-fit:contain; }
    .modal-close {
      position:absolute; top:20px; right:20px;
      background:none; border:1px solid rgba(255,255,255,.2);
      color:#fff; width:40px; height:40px; border-radius:50%; font-size:18px;
      transition:border-color .2s, color .2s; display:grid; place-items:center;
    }
    .modal-close:hover { border-color:var(--accent); color:var(--accent); }

    /* ─── GUÍA DE TALLES MODAL ─────────────────────────── */
    .qv-backdrop {
      position:fixed; inset:0; background:rgba(0,0,0,.72);
      z-index:501; opacity:0; pointer-events:none; transition:opacity .3s;
    }
    .qv-backdrop.open { opacity:1; pointer-events:all; }
    .sg-modal {
      position:fixed; top:50%; left:50%; z-index:502;
      width:min(580px,96vw); max-height:88vh; overflow-y:auto;
      background:var(--surface); border:1px solid var(--border2);
      transform:translate(-50%,-54%) scale(.96);
      opacity:0; pointer-events:none;
      transition:transform .35s var(--ease), opacity .3s;
      padding:36px 32px;
    }
    .sg-modal.open { transform:translate(-50%,-50%) scale(1); opacity:1; pointer-events:all; }
    .sg-modal h2 {
      font-family:var(--serif); font-size:26px; font-weight:400;
      margin-bottom:24px;
    }
    .sg-section-title {
      font-size:9.5px; font-weight:600; letter-spacing:.18em;
      text-transform:uppercase; color:var(--muted); margin:20px 0 10px;
    }
    .sg-table { width:100%; border-collapse:collapse; font-size:13px; }
    .sg-table th {
      background:rgba(255,255,255,.04); padding:10px 14px; text-align:left;
      font-size:9.5px; font-weight:600; letter-spacing:.1em; text-transform:uppercase;
      color:var(--muted); border-bottom:1px solid var(--border);
    }
    .sg-table td { padding:10px 14px; border-bottom:1px solid var(--border); }
    .sg-close {
      position:absolute; top:16px; right:18px;
      background:none; border:1px solid var(--border2); color:var(--muted);
      width:30px; height:30px; border-radius:50%;
      font-size:14px; transition:all .2s; display:grid; place-items:center;
    }
    .sg-close:hover { border-color:var(--accent); color:var(--accent); }

    /* ─── CARRITO PANEL ────────────────────────────────── */
    #overlay {
      position:fixed; inset:0; background:rgba(0,0,0,0.72);
      z-index:800; opacity:0; pointer-events:none;
      transition:opacity 0.35s; backdrop-filter:blur(4px);
    }
    #overlay.active { opacity:1; pointer-events:all; }

    #cartPanel {
      position:fixed; top:0; right:0; bottom:0;
      width:min(420px,100%); background:var(--surface);
      border-left:1px solid var(--border2); z-index:900;
      transform:translateX(100%); transition:transform 0.4s var(--ease);
      display:flex; flex-direction:column;
    }
    #cartPanel.open { transform:translateX(0); }

    .cart-header {
      padding:22px 22px; border-bottom:1px solid var(--border);
      display:flex; align-items:center; justify-content:space-between;
      flex-shrink:0;
    }
    .cart-header-left { display:flex; align-items:baseline; gap:8px; }
    .cart-header h2 { font-family:var(--serif); font-size:22px; font-weight:400; }
    .cart-item-count {
      font-size:12px; color:var(--muted); letter-spacing:.04em;
    }
    .close-cart {
      background:none; border:1px solid var(--border2); color:var(--muted);
      width:34px; height:34px; border-radius:50%; font-size:16px;
      transition:all .2s; display:grid; place-items:center;
    }
    .close-cart:hover { border-color:var(--accent); color:var(--accent); }

    .cart-items-wrap { flex:1; overflow-y:auto; padding:16px 22px; }

    .cart-item {
      display:flex; gap:14px; padding:16px 0;
      border-bottom:1px solid var(--border); animation:slideIn .3s ease;
    }
    .cart-item:last-child { border-bottom:none; }
    @keyframes slideIn { from { opacity:0; transform:translateX(20px); } to { opacity:1; transform:none; } }

    .item-img {
      width:72px; height:92px; flex-shrink:0;
      background:var(--bg); overflow:hidden;
    }
    .item-img img { width:100%; height:100%; object-fit:cover; }

    .item-details { flex:1; min-width:0; }
    .item-name {
      font-family:var(--serif); font-size:15px; line-height:1.2;
      margin-bottom:3px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .item-meta { font-size:11px; color:var(--muted); margin-bottom:8px; }
    .item-price { font-size:14px; color:var(--accent); }

    .item-actions {
      display:flex; align-items:center;
      justify-content:space-between; margin-top:10px;
    }
    .qty-wrap {
      display:flex; align-items:center; gap:8px;
      background:var(--bg); border-radius:20px; padding:4px 10px;
    }
    .qty-btn {
      background:none; border:none; color:var(--muted);
      width:22px; height:22px; font-size:15px; font-weight:300;
      transition:color .2s; display:grid; place-items:center;
    }
    .qty-btn:hover { color:var(--accent); }
    .qty-num { font-size:13px; min-width:18px; text-align:center; }
    .remove-btn {
      background:none; border:none; color:var(--muted);
      font-size:13px; transition:color .2s; padding:4px;
    }
    .remove-btn:hover { color:var(--red); }

    .cart-empty {
      display:flex; flex-direction:column; align-items:center;
      justify-content:center; height:100%; padding:48px 24px; text-align:center; color:var(--muted);
    }
    .cart-empty i { font-size:40px; margin-bottom:14px; opacity:.4; }
    .cart-empty p { font-size:14px; margin-bottom:20px; }
    .btn-empty {
      padding:11px 28px; background:var(--accent); color:var(--bg);
      font-size:10.5px; font-weight:700; letter-spacing:.1em; text-transform:uppercase;
      transition:background .2s;
    }
    .btn-empty:hover { background:var(--adk); }

    .cart-footer {
      border-top:1px solid var(--border); padding:18px 22px;
      background:var(--surface); flex-shrink:0;
    }

    /* Barra envío gratis */
    .shipping-bar { margin-bottom:16px; }
    .shipping-msg { font-size:12px; color:var(--muted2); margin-bottom:8px; }
    .shipping-msg strong { color:var(--text); }
    .shipping-track {
      height:3px; background:var(--border2); border-radius:2px; overflow:hidden;
    }
    .shipping-fill {
      height:100%; background:var(--accent);
      border-radius:2px; transition:width .5s var(--ease2);
    }

    .subtotal-row {
      display:flex; justify-content:space-between; align-items:center;
      margin-bottom:14px;
    }
    .subtotal-label { font-size:11px; font-weight:600; letter-spacing:.1em; text-transform:uppercase; color:var(--muted); }
    .subtotal-amount { font-family:var(--serif); font-size:24px; color:var(--accent); }

    .checkout-btns { display:flex; flex-direction:column; gap:8px; }
    .btn-mp {
      width:100%; height:48px; background:#009ee3; color:#fff; border:none;
      font-size:11.5px; font-weight:700; letter-spacing:.12em; text-transform:uppercase;
      display:flex; align-items:center; justify-content:center; gap:8px;
      transition:background .2s, transform .2s;
    }
    .btn-mp:hover { background:#0083c7; transform:translateY(-1px); }
    .btn-wacheckout {
      width:100%; height:48px; background:transparent; color:var(--text);
      border:1.5px solid var(--border2);
      font-size:11.5px; font-weight:600; letter-spacing:.1em; text-transform:uppercase;
      display:flex; align-items:center; justify-content:center; gap:8px;
      transition:all .2s;
    }
    .btn-wacheckout:hover {
      border-color:#25d366; color:#25d366; background:rgba(37,211,102,.06);
      transform:translateY(-1px);
    }
    .security-note {
      text-align:center; font-size:10px; color:var(--muted);
      margin-top:10px; display:flex; align-items:center; justify-content:center; gap:5px;
    }
    .security-note i { color:#4db87a; font-size:11px; }

    /* ─── TOAST ────────────────────────────────────────── */
    #cartNotification {
      position:fixed; bottom:28px; left:50%;
      transform:translateX(-50%) translateY(70px);
      background:var(--surface); border:1px solid var(--accent);
      color:var(--text); padding:12px 22px;
      border-radius:40px; z-index:1000;
      display:flex; align-items:center; gap:10px;
      opacity:0; transition:all .35s var(--ease);
      box-shadow:0 4px 24px rgba(0,0,0,.4); cursor:pointer;
      white-space:nowrap;
    }
    #cartNotification.show { transform:translateX(-50%) translateY(0); opacity:1; }
    #cartNotification .notif-icon { color:var(--accent); font-size:16px; }
    #cartNotification .notif-text { font-size:13px; }
    #cartNotification .notif-cta {
      font-size:10.5px; font-weight:600; color:var(--accent);
      letter-spacing:.08em; text-transform:uppercase; margin-left:4px;
    }

    /* ─── WA FLOAT ──────────────────────────────────────── */
    .wa-float {
      position:fixed; bottom:26px; right:26px; z-index:400;
      width:50px; height:50px; border-radius:50%;
      background:#25d366; border:none; cursor:pointer;
      display:grid; place-items:center;
      box-shadow:0 4px 18px rgba(37,211,102,.35);
      transition:transform .3s var(--ease), box-shadow .3s;
    }
    .wa-float:hover { transform:scale(1.08); box-shadow:0 6px 28px rgba(37,211,102,.5); }
    .wa-float i { font-size:22px; color:#fff; }

    /* ─── STICKY MOBILE CTA ─────────────────────────────── */
    .sticky-cta-bar {
      display:none;
      position:fixed; bottom:0; left:0; right:0; z-index:400;
      background:var(--surface); border-top:1px solid var(--border2);
      padding:12px 16px 16px; /* extra padding-bottom for safe area */
      padding-bottom:max(16px, env(safe-area-inset-bottom));
      gap:10px; align-items:center;
      box-shadow:0 -8px 32px rgba(0,0,0,.4);
      transform:translateY(100%); transition:transform .35s var(--ease);
    }
    .sticky-cta-bar.show { transform:translateY(0); }
    .sticky-cta-price {
      font-family:var(--serif); font-size:20px; color:var(--accent);
      flex-shrink:0;
    }
    .sticky-cta-btn {
      flex:1; height:48px; background:var(--accent); color:var(--bg);
      border:none; font-size:11px; font-weight:700; letter-spacing:.14em;
      text-transform:uppercase; display:flex; align-items:center; justify-content:center; gap:8px;
      transition:background .2s;
    }
    .sticky-cta-btn:hover { background:var(--adk); }
    @media (max-width:900px) { .sticky-cta-bar { display:flex; } }

    /* ─── ANIMACIONES ───────────────────────────────────── */
    @keyframes shake {
      0%,100% { transform:translateX(0); }
      20% { transform:translateX(-7px); }
      40% { transform:translateX(7px); }
      60% { transform:translateX(-4px); }
      80% { transform:translateX(4px); }
    }

    .fade-up {
      opacity:0; transform:translateY(24px);
      transition:opacity .7s var(--ease), transform .7s var(--ease);
    }
    .fade-up.in { opacity:1; transform:none; }

    /* ─── RESPONSIVE ────────────────────────────────────── */
    @media (max-width:1100px) {
      .product-columns { grid-template-columns:1fr 1fr; gap:40px; }
    }
    @media (max-width:900px) {
      #header { padding:0 20px; }
      .header-nav { display:none; }
      .product-page { padding:24px 20px 80px; }
      .product-columns { grid-template-columns:1fr; gap:28px; margin-bottom:60px; }

      /* En mobile: thumbnails abajo, imagen arriba */
      .gallery-layout { grid-template-columns:1fr; }
      .thumbnails {
        flex-direction:row; max-height:none; order:2;
        overflow-x:auto; padding-bottom:4px;
      }
      .gallery-dots { display:flex; }

      .gallery { position:relative; top:0; }
      .breadcrumb { padding:16px 20px 0; }
      .products-grid { grid-template-columns:repeat(2,1fr); }
    }
    @media (max-width:600px) {
      .product-title { font-size:32px; }
      .benefits { grid-template-columns:1fr; }
      .products-grid { grid-template-columns:repeat(2,1fr); gap:2px; }
      .action-buttons { gap:8px; }
    }
    @media (hover:none) and (pointer:coarse) {
      .custom-cursor,[class*="cursor"] { display:none!important; }
      body { cursor:auto!important; }
    }
  </style>
</head>
<body>

<!-- ═══════════ HEADER ════════════ -->
<header id="header">
  <a href="index.html">
    <img src="images/LogoB&D.png" alt="Bara & Co" class="logo-img"/>
  </a>
  <nav class="header-nav">
    <ul>
      <li><a href="index.html">Inicio</a></li>
      <li><a href="tienda.html" class="active">Tienda</a></li>
      <li><a href="lookbook.html">Lookbook</a></li>
      <li><a href="contacto.html">Contacto</a></li>
    </ul>
  </nav>
  <div class="header-right">
    <button class="header-icon-btn" onclick="window.location.href='tienda.html'" aria-label="Buscar">
      <i class="fas fa-search"></i>
    </button>
    <button class="header-icon-btn" onclick="toggleCart()" aria-label="Carrito">
      <i class="fas fa-shopping-bag"></i>
      <span class="cart-badge cart-count">0</span>
    </button>
  </div>
</header>

<!-- ═══════════ BREADCRUMB ════════════ -->
<div class="breadcrumb">
  <a href="index.html">Inicio</a>
  <i class="fas fa-chevron-right"></i>
  <a href="tienda.html">Tienda</a>
  <i class="fas fa-chevron-right"></i>
  <span id="breadcrumbCat"></span>
  <i class="fas fa-chevron-right" id="bcArrow2"></i>
  <span id="breadcrumbName"></span>
</div>

<!-- ═══════════ PÁGINA DE PRODUCTO ════════════ -->
<div class="product-page">
  <div class="product-columns">

    <!-- ── GALERÍA ── -->
    <div class="gallery fade-up">
      <div class="gallery-layout">

        <!-- Thumbnails laterales -->
        <div class="thumbnails" id="thumbnails"></div>

        <!-- Imagen principal -->
        <div class="main-image" id="mainImageWrap" onclick="openImageModal()">
          <div class="img-badges" id="imgBadges"></div>
          <img src="" alt="" id="currentImage"/>
          <div class="zoom-hint">
            <i class="fas fa-search-plus"></i> Ampliar
          </div>
        </div>

      </div>
      <!-- Dots (solo mobile) -->
      <div class="gallery-dots" id="galleryDots"></div>
    </div>

    <!-- ── INFO PRODUCTO ── -->
    <div class="product-info fade-up" style="transition-delay:.1s">

      <!-- Categoría + wishlist -->
      <div class="info-top">
        <p class="product-category" id="productCategory"></p>
        <button class="wishlist-btn" id="wishlistBtn" aria-label="Guardar en favoritos">
          <i class="far fa-heart"></i>
        </button>
      </div>

      <h1 class="product-title" id="productName"></h1>

      <!-- Precio -->
      <div class="price-block" id="priceBlock"></div>

      <!-- Urgencia de stock -->
      <div class="stock-urgency" id="stockUrgency">
        <i class="fas fa-bolt"></i>
        <span id="stockUrgencyText"></span>
      </div>

      <div class="divider"></div>

      <!-- Descripción -->
      <p class="product-description" id="productDescription"></p>

      <!-- Composición / cuidados -->
      <div class="material-block" id="materialBlock">
        <div class="divider" style="margin:20px 0 16px;"></div>
        <div class="material-title">Composición &amp; cuidados</div>
        <div class="material-tags" id="materialTags"></div>
        <div class="care-icons" id="careIcons"></div>
      </div>

      <div class="divider"></div>

      <!-- Selector talle -->
      <div class="section-label">
        <span>Talle <span class="selected-indicator" id="selectedSizeLabel"></span></span>
        <span class="size-guide-link" onclick="openSizeGuide()">
          <i class="fas fa-ruler-horizontal" style="font-size:9px;margin-right:3px;"></i> Guía de talles
        </span>
      </div>
      <div class="size-options" id="sizeOptions"></div>
      <p id="sizeError"></p>

      <!-- Selector color -->
      <div id="colorSection" style="display:none;">
        <div class="section-label" style="margin-top:4px;">
          Color <span class="selected-indicator" id="selectedColorLabel"></span>
        </div>
        <div class="color-options" id="colorOptions"></div>
        <div class="divider" style="margin:20px 0;"></div>
      </div>

      <!-- Botones de acción -->
      <div class="action-buttons">
        <button class="btn-add" id="addToCartBtn" onclick="handleAddToCart()">
          <i class="fas fa-shopping-bag"></i>
          <span>Agregar al carrito</span>
        </button>
        <button class="btn-wa" id="whatsappBtn" aria-label="Consultar por WhatsApp">
          <i class="fab fa-whatsapp"></i>
        </button>
      </div>

      <!-- Beneficios -->
      <div class="benefits">
        <div class="benefit-item">
          <i class="fas fa-truck"></i>
          <span class="benefit-label">Envío gratis</span>
          <span class="benefit-sub">+$80.000</span>
        </div>
        <div class="benefit-item">
          <i class="fas fa-undo-alt"></i>
          <span class="benefit-label">30 días</span>
          <span class="benefit-sub">para cambios</span>
        </div>
        <div class="benefit-item">
          <i class="fas fa-shield-alt"></i>
          <span class="benefit-label">Pago seguro</span>
          <span class="benefit-sub">SSL 256-bit</span>
        </div>
      </div>

      <!-- Medios de pago -->
      <div class="payment-block">
        <div class="payment-label">Métodos de pago</div>
        <div class="payment-row">
          <span class="pay-pill pay-visa">VISA</span>
          <span class="pay-pill pay-mc">Master<span>card</span></span>
          <span class="pay-pill pay-amex">AMEX</span>
          <span class="pay-pill pay-mp">MercadoPago</span>
          <span class="pay-ssl"><i class="fas fa-lock"></i> Protegido</span>
        </div>
      </div>

      <!-- Acordeón políticas -->
      <div class="policy-accordion">
        <div class="policy-item" id="policyEnvio">
          <button class="policy-trigger" onclick="togglePolicy('policyEnvio')">
            <span class="policy-trigger-left">
              <i class="fas fa-truck"></i> Envíos
            </span>
            <i class="fas fa-chevron-down policy-chevron"></i>
          </button>
          <div class="policy-body">
            <div class="policy-content">
              <strong>Envío gratis</strong> en compras mayores a $80.000 a todo el país.
              <ul>
                <li>AMBA: 2–4 días hábiles</li>
                <li>Interior: 4–7 días hábiles (según zona)</li>
                <li>Retiro en showroom: coordinar por WhatsApp</li>
                <li>Tracking por email una vez despachado</li>
              </ul>
            </div>
          </div>
        </div>
        <div class="policy-item" id="policyCambios">
          <button class="policy-trigger" onclick="togglePolicy('policyCambios')">
            <span class="policy-trigger-left">
              <i class="fas fa-undo-alt"></i> Cambios y devoluciones
            </span>
            <i class="fas fa-chevron-down policy-chevron"></i>
          </button>
          <div class="policy-body">
            <div class="policy-content">
              Tenés <strong>30 días</strong> para cambiar por talle, color u otro artículo.
              <ul>
                <li>Prenda sin uso, con etiqueta original</li>
                <li>Costo de envío del cambio a cargo del cliente</li>
                <li>Devoluciones solo en caso de producto defectuoso</li>
                <li>Iniciá el proceso por <a href="contacto.html" style="color:var(--accent)">WhatsApp o contacto</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="policy-item" id="policyPago">
          <button class="policy-trigger" onclick="togglePolicy('policyPago')">
            <span class="policy-trigger-left">
              <i class="fas fa-shield-alt"></i> Seguridad de pago
            </span>
            <i class="fas fa-chevron-down policy-chevron"></i>
          </button>
          <div class="policy-body">
            <div class="policy-content">
              Transacciones procesadas por <strong>MercadoPago</strong> con encriptación SSL 256-bit.
              <ul>
                <li>Tarjetas de crédito y débito (Visa, MC, Amex)</li>
                <li>Pago en cuotas según banco</li>
                <li>Transferencia / saldo MercadoPago</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

    </div><!-- fin product-info -->
  </div><!-- fin product-columns -->

  <!-- Completá el look -->
  <div class="products-section" id="crossellSection" style="display:none;">
    <div class="section-header">
      <h3>Completá el look</h3>
      <a href="tienda.html">Ver tienda</a>
    </div>
    <div class="products-grid" id="crossellGrid"></div>
  </div>

  <!-- También te puede gustar -->
  <div class="products-section related">
    <div class="section-header">
      <h3>También te puede gustar</h3>
      <a href="tienda.html">Ver todo</a>
    </div>
    <div class="products-grid" id="relatedProducts"></div>
  </div>

</div><!-- fin product-page -->

<!-- ═══════════ MODAL IMAGEN ════════════ -->
<div class="image-modal" id="imageModal" onclick="closeImageModal()">
  <button class="modal-close" onclick="closeImageModal()">
    <i class="fas fa-times"></i>
  </button>
  <img src="" alt="" class="modal-img" id="modalImage"/>
</div>

<!-- ═══════════ GUÍA DE TALLES ════════════ -->
<div class="qv-backdrop" id="sgBackdrop" onclick="closeSizeGuide()"></div>
<div class="sg-modal" id="sgModal">
  <button class="sg-close" onclick="closeSizeGuide()"><i class="fas fa-times"></i></button>
  <h2>Guía de Talles</h2>
  <div class="sg-section-title">Ropa Mujer</div>
  <table class="sg-table">
    <thead><tr><th>Talle</th><th>Pecho (cm)</th><th>Cintura (cm)</th><th>Cadera (cm)</th></tr></thead>
    <tbody>
      <tr><td>XS</td><td>80–84</td><td>62–66</td><td>84–88</td></tr>
      <tr><td>S</td><td>85–88</td><td>67–70</td><td>89–92</td></tr>
      <tr><td>M</td><td>89–93</td><td>71–75</td><td>93–97</td></tr>
      <tr><td>L</td><td>94–99</td><td>76–81</td><td>98–103</td></tr>
    </tbody>
  </table>
  <div class="sg-section-title" style="margin-top:20px;">Ropa Hombre</div>
  <table class="sg-table">
    <thead><tr><th>Talle</th><th>Pecho (cm)</th><th>Cintura (cm)</th><th>Cadera (cm)</th></tr></thead>
    <tbody>
      <tr><td>S</td><td>88–92</td><td>74–78</td><td>88–92</td></tr>
      <tr><td>M</td><td>93–98</td><td>79–84</td><td>93–98</td></tr>
      <tr><td>L</td><td>99–104</td><td>85–90</td><td>99–104</td></tr>
      <tr><td>XL</td><td>105–112</td><td>91–98</td><td>105–112</td></tr>
    </tbody>
  </table>
</div>

<!-- ═══════════ CARRITO ════════════ -->
<div id="overlay" onclick="toggleCart()"></div>
<div id="cartPanel">
  <div class="cart-header">
    <div class="cart-header-left">
      <h2>Carrito</h2>
      <span class="cart-item-count cart-count"></span>
    </div>
    <button class="close-cart" onclick="toggleCart()"><i class="fas fa-times"></i></button>
  </div>
  <div class="cart-items-wrap cart-items">
    <div class="cart-empty">
      <i class="fas fa-shopping-bag"></i>
      <p>Tu carrito está vacío</p>
      <a href="tienda.html" class="btn-empty">Explorar tienda</a>
    </div>
  </div>
  <div class="cart-footer"></div>
</div>

<!-- ═══════════ TOAST ════════════ -->
<div id="cartNotification">
  <i class="fas fa-check-circle notif-icon"></i>
  <span class="notif-text">Producto agregado</span>
  <span class="notif-cta">Ver carrito →</span>
</div>

<!-- ═══════════ STICKY CTA MOBILE ════════════ -->
<div class="sticky-cta-bar" id="stickyCta">
  <div class="sticky-cta-price" id="stickyCtaPrice"></div>
  <button class="sticky-cta-btn" onclick="handleAddToCart()">
    <i class="fas fa-shopping-bag"></i> Agregar al carrito
  </button>
</div>

<!-- ═══════════ WA FLOAT ════════════ -->
<button class="wa-float"
  onclick="window.open('https://wa.me/5493525614281?text=Hola!%20Quiero%20consultar%20sobre%20un%20producto','_blank')"
  title="Consultar por WhatsApp" aria-label="WhatsApp">
  <i class="fab fa-whatsapp"></i>
</button>

<script src="js/main.js"></script>
<script src="js/carrito.js"></script>

<script>
/* ══════════════════════════════════════
   BARA & CO — PÁGINA DE PRODUCTO
══════════════════════════════════════ */
let productos = [];
let currentProduct = null;
let selectedSize  = null;
let selectedColor = null;
let currentImgIdx = 0;

const urlParams = new URLSearchParams(window.location.search);
const productId = urlParams.get('id');

// ─── CARGAR ───────────────────────────
async function cargarProductos() {
  try {
    const res = await fetch('productos.json?t=' + Date.now());
    if (!res.ok) throw new Error('Error al cargar productos.json');
    productos = await res.json();
    currentProduct = productos.find(p => p.id === productId && p.activo !== false);
    if (!currentProduct) { window.location.href = 'tienda.html'; return; }
    renderizarProducto();
    actualizarMetaTags();
    cargarRelacionados();
  } catch (e) {
    console.error(e);
    window.location.href = 'tienda.html';
  }
}

// ─── META TAGS ────────────────────────
function actualizarMetaTags() {
  if (!currentProduct) return;
  const titulo = `${currentProduct.nombre} — Bara & Co | $${currentProduct.precio.toLocaleString('es-AR')}`;
  const desc   = currentProduct.descripcion || `${currentProduct.nombre} · Bara & Co. Compra online con envío a todo el país.`;
  const imagen = currentProduct.imagen || (currentProduct.imagenes?.[0]) || '';
  const url    = window.location.href;
  document.getElementById('pageTitle').textContent  = titulo;
  document.getElementById('metaDesc').content       = desc;
  document.getElementById('ogTitle').content        = titulo;
  document.getElementById('ogDesc').content         = desc;
  document.getElementById('ogImage').content        = imagen;
  document.getElementById('ogUrl').content          = url;
  document.getElementById('twTitle').content        = titulo;
  document.getElementById('twDesc').content         = desc;
  document.getElementById('twImage').content        = imagen;
}

// ─── DESCRIPCIÓN AUTO ─────────────────
function generarDescripcion(p) {
  const plantillas = {
    'Remeras':    'Remera oversize de alta calidad, ideal para looks urbanos y casuales. Diseño exclusivo Bara & Co.',
    'Pantalones': 'Pantalón de diseño urbano con excelente caída. Confección cuidada con telas premium.',
    'Camperas':   'Campera de diseño urbano para entretiempo. Un básico infaltable en cualquier guardarropa.',
    'Buzos':      'Buzo cómodo con telas de calidad. Perfecto para los días frescos, solo o en capas.',
    'Conjuntos':  'Conjunto de diseño exclusivo Bara & Co. Prendas pensadas para usarse juntas o por separado.',
    'Shorts':     'Short de verano con diseño exclusivo. Tela liviana y cómoda, ideal para el calor.',
    'Polleras':   'Pollera de corte contemporáneo con caída fluida. Versátil y fácil de combinar.',
  };
  const subcat  = p.subcategoria || '';
  const talles  = (p.tallesDisponibles || p.talles || []).filter(t => t && t !== 'Unico');
  const colores = Array.isArray(p.colores)
    ? p.colores.map(c => typeof c === 'object' ? c.nombre : c).filter(Boolean) : [];
  const base = plantillas[subcat] || 'Prenda de diseño exclusivo Bara & Co. Calidad y estilo para el día a día.';
  const extra = [
    talles.length  ? `Talles: ${talles.join(', ')}.`  : '',
    colores.length ? `Colores: ${colores.join(', ')}.` : '',
  ].filter(Boolean).join(' ');
  return [base, extra].filter(Boolean).join(' ');
}

// ─── RENDERIZAR ──────────────────────
function renderizarProducto() {
  const p = currentProduct;

  // Breadcrumb
  document.getElementById('breadcrumbCat').textContent  = p.categoria;
  document.getElementById('breadcrumbName').textContent = p.nombre;

  // Imágenes
  const imagenes = p.imagenes || [p.imagen];
  const mainImg  = document.getElementById('currentImage');
  mainImg.src = imagenes[0];
  mainImg.alt = p.nombre;

  // Thumbnails
  const thumbsEl = document.getElementById('thumbnails');
  thumbsEl.innerHTML = '';
  imagenes.forEach((img, i) => {
    const div = document.createElement('div');
    div.className = 'thumb' + (i === 0 ? ' active' : '');
    div.innerHTML = `<img src="${img}" alt="${p.nombre}" loading="${i === 0 ? 'eager' : 'lazy'}"/>`;
    div.onclick = () => cambiarImagen(i);
    thumbsEl.appendChild(div);
  });

  // Dots (mobile)
  const dotsEl = document.getElementById('galleryDots');
  dotsEl.innerHTML = '';
  imagenes.forEach((_, i) => {
    const btn = document.createElement('button');
    btn.className = 'g-dot' + (i === 0 ? ' active' : '');
    btn.onclick = () => cambiarImagen(i);
    dotsEl.appendChild(btn);
  });

  // Badges sobre imagen
  const badgesEl = document.getElementById('imgBadges');
  badgesEl.innerHTML = '';
  if (p.precioAnterior) {
    const disc = Math.round((1 - p.precio / p.precioAnterior) * 100);
    badgesEl.innerHTML += `<span class="img-badge badge-sale">-${disc}%</span>`;
  }
  if (p.nuevo) {
    badgesEl.innerHTML += `<span class="img-badge badge-new">Nuevo</span>`;
  }

  // Categoría
  document.getElementById('productCategory').textContent =
    [p.categoria, p.subcategoria].filter(Boolean).join(' · ');

  // Título
  document.getElementById('productName').textContent = p.nombre;

  // Precio
  const priceEl = document.getElementById('priceBlock');
  if (p.precioAnterior) {
    const disc = Math.round((1 - p.precio / p.precioAnterior) * 100);
    priceEl.innerHTML = `
      <span class="price-before">$${p.precioAnterior.toLocaleString('es-AR')}</span>
      <span class="price-current">$${p.precio.toLocaleString('es-AR')}</span>
      <span class="discount-pill">-${disc}%</span>`;
  } else {
    priceEl.innerHTML = `<span class="price-current">$${p.precio.toLocaleString('es-AR')}</span>`;
  }

  // Stock urgency
  const stock = p.stock;
  if (typeof stock === 'number' && stock > 0 && stock <= 5) {
    document.getElementById('stockUrgencyText').textContent =
      `¡Solo quedan ${stock} unidad${stock === 1 ? '' : 'es'}!`;
    document.getElementById('stockUrgency').classList.add('show');
  }

  // Descripción
  const desc = (p.descripcion && p.descripcion.trim()) ? p.descripcion : generarDescripcion(p);
  document.getElementById('productDescription').textContent = desc;

  // Material
  const mat  = p.material || p.composicion || null;
  const care = p.cuidados || p.cuidado || null;
  if (mat || care) {
    document.getElementById('materialBlock').style.display = 'block';
    if (mat) {
      const tagsEl = document.getElementById('materialTags');
      (Array.isArray(mat) ? mat : [mat]).forEach(m => {
        const sp = document.createElement('span');
        sp.className = 'material-tag';
        sp.innerHTML = `<i class="fas fa-tag"></i>${m}`;
        tagsEl.appendChild(sp);
      });
    }
    if (care) {
      const careEl = document.getElementById('careIcons');
      const iconMap = {
        'lavar a mano': { icon:'fa-hands-wash', label:'A mano' },
        'no secar':     { icon:'fa-ban',         label:'Sin secadora' },
        'no planchar':  { icon:'fa-ban',         label:'Sin plancha' },
        'lavar frio':   { icon:'fa-snowflake',   label:'Frío' },
        'lavar maquina':{ icon:'fa-tshirt',      label:'Máquina 30°' },
      };
      (Array.isArray(care) ? care : [care]).forEach(c => {
        const info = iconMap[c.toLowerCase()] || { icon:'fa-info-circle', label:c };
        const div  = document.createElement('div');
        div.className = 'care-icon';
        div.innerHTML = `<i class="fas ${info.icon}"></i><span>${info.label}</span>`;
        careEl.appendChild(div);
      });
    }
  }

  // Talles con stock
  const talles = p.tallesDisponibles || p.talles || [];
  const stockTalles = p.stockTalles || {};
  const sizeEl = document.getElementById('sizeOptions');
  sizeEl.innerHTML = '';

  // Calcular disponibilidad general para el resumen
  let hayStock = false, hayStockBajo = false;

  talles.forEach(t => {
    const nombre_t = typeof t === 'object' ? t.nombre : t;
    const agotado  = t.agotado === true || (typeof t === 'object' && t.stock === 0);

    // Obtener stock: primero del objeto talle, luego de stockTalles
    let stock = null;
    if (typeof t === 'object' && t.stock !== undefined) {
      stock = t.stock;
    } else if (stockTalles[nombre_t] !== undefined && stockTalles[nombre_t] !== null) {
      stock = stockTalles[nombre_t];
    }

    const btn = document.createElement('button');
    let cls = 'size-btn';
    if (agotado || stock === 0) cls += ' out-of-stock';
    else if (stock !== null && stock <= 3) { cls += ' stock-low'; hayStockBajo = true; hayStock = true; }
    else { hayStock = true; }
    btn.className = cls;

    // Nombre del talle
    const nameSpan = document.createElement('span');
    nameSpan.textContent = nombre_t;
    btn.appendChild(nameSpan);

    // Info de stock debajo
    if (stock !== null) {
      const infoSpan = document.createElement('span');
      infoSpan.className = 'size-stock-info';
      if (agotado || stock === 0) {
        infoSpan.textContent = 'Agotado';
        infoSpan.className += ' sout';
      } else if (stock <= 3) {
        infoSpan.textContent = `¡Últimas ${stock}!`;
        infoSpan.className += ' slow';
      } else if (stock <= 10) {
        infoSpan.textContent = `${stock} disp.`;
        infoSpan.className += ' sok';
      }
      btn.appendChild(infoSpan);
    }

    if (!agotado && stock !== 0) {
      btn.onclick = () => seleccionarTalle(nombre_t, btn, stock);
    }
    sizeEl.appendChild(btn);
  });

  // Resumen de stock disponible
  let summaryEl = document.getElementById('stockSummary');
  if (!summaryEl) {
    summaryEl = document.createElement('div');
    summaryEl.id = 'stockSummary';
    summaryEl.className = 'size-stock-summary';
    sizeEl.insertAdjacentElement('afterend', summaryEl);
  }
  if (talles.length > 0 && hayStock) {
    const cls = hayStockBajo ? 'low' : 'ok';
    summaryEl.innerHTML = hayStockBajo
      ? `<span class="dot ${cls}"></span> Stock limitado en algunos talles`
      : `<span class="dot ${cls}"></span> Todos los talles disponibles`;
  } else {
    summaryEl.innerHTML = '';
  }

  // Colores
  if (p.colores && p.colores.length > 0) {
    document.getElementById('colorSection').style.display = 'block';
    const colEl = document.getElementById('colorOptions');
    colEl.innerHTML = '';
    p.colores.forEach(color => {
      const nombre = typeof color === 'object' ? color.nombre : color;
      const btn = document.createElement('button');
      btn.className = 'color-btn';
      btn.style.backgroundColor = getColorCode(nombre);
      btn.title = nombre;
      btn.onclick = () => seleccionarColor(nombre, btn);
      colEl.appendChild(btn);
    });
  }

  // Sticky CTA bar (mobile) — precio
  const stickyPrice = document.getElementById('stickyCtaPrice');
  if (stickyPrice) stickyPrice.textContent = '$' + p.precio.toLocaleString('es-AR');

  // Wishlist toggle (re-bind on each load)
  const wBtn = document.getElementById('wishlistBtn');
  if (wBtn && !wBtn._bound) {
    wBtn._bound = true;
    wBtn.addEventListener('click', function() {
      this.classList.toggle('active');
      const icon = this.querySelector('i');
      icon.className = this.classList.contains('active') ? 'fas fa-heart' : 'far fa-heart';
    });
  }
}

// ─── INTERACCIONES ───────────────────
function cambiarImagen(index) {
  currentImgIdx = index;
  const imagenes = currentProduct.imagenes || [currentProduct.imagen];
  document.getElementById('currentImage').src = imagenes[index];
  document.querySelectorAll('.thumb').forEach((t, i)  => t.classList.toggle('active', i === index));
  document.querySelectorAll('.g-dot').forEach((d, i)  => d.classList.toggle('active', i === index));
}

function seleccionarTalle(talle, btn, stock) {
  document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  selectedSize = talle;
  document.getElementById('selectedSizeLabel').textContent = '— ' + talle;
  document.getElementById('sizeError').textContent = '';

  // Mostrar urgencia de stock para este talle específico
  const urgEl = document.getElementById('stockUrgency');
  const urgText = document.getElementById('stockUrgencyText');
  if (stock !== null && stock !== undefined && stock > 0 && stock <= 3) {
    urgText.textContent = `¡Solo quedan ${stock} unidad${stock === 1 ? '' : 'es'} en talle ${talle}!`;
    urgEl.classList.add('show');
  } else if (stock !== null && stock !== undefined && stock === 0) {
    // No debería llegar aquí pero por si acaso
    urgEl.classList.remove('show');
  } else if (currentProduct) {
    // Restaurar urgencia general si aplica
    const stockGeneral = currentProduct.stock;
    if (typeof stockGeneral === 'number' && stockGeneral > 0 && stockGeneral <= 5) {
      urgText.textContent = `¡Solo quedan ${stockGeneral} unidad${stockGeneral === 1 ? '' : 'es'}!`;
      urgEl.classList.add('show');
    } else {
      urgEl.classList.remove('show');
    }
  }
}

function seleccionarColor(color, btn) {
  document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  selectedColor = color;
  document.getElementById('selectedColorLabel').textContent = '— ' + color;
}

function getColorCode(color) {
  const map = {
    'Negro':'#111','Blanco':'#f8f8f8','Azul':'#1a66cc','Rojo':'#cc1a1a',
    'Verde':'#1a8c55','Amarillo':'#f0c428','Gris':'#7a7a7a','Beige':'#f0e8dc',
    'Camel':'#c19a6b','Mostaza':'#d4a826','Lila':'#b89ec8','Fucsia':'#e0106a',
    'Arena':'#e8d8c4','Marino':'#102050',
  };
  return map[color] || '#888';
}

// ─── AGREGAR AL CARRITO ──────────────
function handleAddToCart() {
  if (!currentProduct) return;
  const talles = currentProduct.tallesDisponibles || currentProduct.talles || [];
  const needsSize = talles.length > 0
    && (typeof talles[0] === 'string' ? talles[0] !== 'Unico' : talles[0].nombre !== 'Unico');
  if (needsSize && !selectedSize) {
    const sizeEl = document.getElementById('sizeOptions');
    sizeEl.style.animation = 'none';
    sizeEl.offsetHeight;
    sizeEl.style.animation = 'shake .4s ease';
    document.getElementById('sizeError').innerHTML =
      '<i class="fas fa-exclamation-circle" style="color:#e07b6a"></i> Seleccioná un talle para continuar';
    return;
  }
  const talleParaCarrito = needsSize ? (selectedSize || '') : '';
  agregarAlCarrito(
    currentProduct.id,
    currentProduct.nombre,
    currentProduct.precio,
    currentProduct.imagen || (currentProduct.imagenes?.[0]) || '',
    talleParaCarrito,
    selectedColor || ''
  );
}

// ─── POLÍTICAS ACORDEÓN ──────────────
function togglePolicy(id) {
  const item = document.getElementById(id);
  const wasOpen = item.classList.contains('open');
  document.querySelectorAll('.policy-item').forEach(i => i.classList.remove('open'));
  if (!wasOpen) item.classList.add('open');
}

// ─── RELACIONADOS ─────────────────────
function cargarRelacionados() {
  const rel = productos
    .filter(p => p.categoria === currentProduct.categoria
      && p.id !== currentProduct.id && p.activo !== false)
    .slice(0, 4);
  const grid = document.getElementById('relatedProducts');
  grid.innerHTML = '';
  rel.forEach(p => buildProdCard(p, grid));
  cargarCrossSelling();
}

// ─── CROSS-SELLING ────────────────────
function cargarCrossSelling() {
  const mapa = {
    'Remeras':    ['Pantalones', 'Bermudas', 'Shorts', 'accesorios'],
    'Pantalones': ['Remeras', 'Camperas', 'Buzos', 'accesorios'],
    'Camperas':   ['Remeras', 'Pantalones', 'accesorios'],
    'Buzos':      ['Pantalones', 'Remeras'],
    'Polleras':   ['Remeras', 'accesorios'],
    'Conjuntos':  ['accesorios'],
    'Gorras':     ['Remeras', 'Buzos'],
  };
  const subcat = currentProduct.subcategoria || '';
  const targets = mapa[subcat] || [];
  if (!targets.length) return;

  const candidatos = productos.filter(p =>
    p.id !== currentProduct.id && p.activo !== false &&
    !(typeof p.stock === 'number' && p.stock === 0) &&
    targets.some(t => p.subcategoria === t || p.categoria === t)
  ).sort(() => Math.random() - .5).slice(0, 4);

  if (!candidatos.length) return;
  const section = document.getElementById('crossellSection');
  const grid    = document.getElementById('crossellGrid');
  section.style.display = 'block';
  grid.innerHTML = '';
  candidatos.forEach(p => buildProdCard(p, grid));
}

// ─── BUILD CARD (usado en ambas secciones) ─
function buildProdCard(p, container) {
  const disc    = p.precioAnterior ? Math.round((1 - p.precio / p.precioAnterior) * 100) : 0;
  const catLabel = p.subcategoria || p.categoria;
  const card = document.createElement('div');
  card.className = 'prod-card';
  card.onclick = () => window.location.href = `producto.html?id=${p.id}`;
  card.innerHTML = `
    <div class="prod-card-img">
      ${disc ? `<span class="prod-badge prod-badge-sale">-${disc}%</span>` : ''}
      <span class="prod-badge prod-badge-cat">${catLabel}</span>
      <img src="${p.imagen}" alt="${p.nombre}" loading="lazy"/>
      <div class="prod-card-overlay">
        <button class="overlay-add"
          onclick="event.stopPropagation(); agregarAlCarrito('${p.id}','${p.nombre}',${p.precio},'${p.imagen}')">
          <i class="fas fa-shopping-bag"></i> Agregar
        </button>
      </div>
    </div>
    <div class="prod-card-info">
      <div class="prod-cat">${catLabel}</div>
      <div class="prod-name">${p.nombre}</div>
      <div class="prod-price">
        ${p.precioAnterior ? `<del>$${p.precioAnterior.toLocaleString('es-AR')}</del> ` : ''}
        $${p.precio.toLocaleString('es-AR')}
      </div>
    </div>`;
  container.appendChild(card);
}

// ─── MODAL IMAGEN ─────────────────────
function openImageModal() {
  document.getElementById('imageModal').classList.add('open');
  document.getElementById('modalImage').src = document.getElementById('currentImage').src;
  document.body.style.overflow = 'hidden';
}
function closeImageModal() {
  document.getElementById('imageModal').classList.remove('open');
  document.body.style.overflow = '';
}

// ─── GUÍA DE TALLES ───────────────────
function openSizeGuide() {
  document.getElementById('sgModal').classList.add('open');
  document.getElementById('sgBackdrop').classList.add('open');
  document.body.style.overflow = 'hidden';
}
function closeSizeGuide() {
  document.getElementById('sgModal').classList.remove('open');
  document.getElementById('sgBackdrop').classList.remove('open');
  document.body.style.overflow = '';
}

// ─── FADE-UP AL SCROLL ────────────────
function initFadeUp() {
  const obs = new IntersectionObserver(entries => {
    entries.forEach(e => { if (e.isIntersecting) { e.target.classList.add('in'); obs.unobserve(e.target); } });
  }, { threshold:.12 });
  document.querySelectorAll('.fade-up').forEach(el => obs.observe(el));
}

// ─── INIT ─────────────────────────────
document.addEventListener('DOMContentLoaded', () => {
  // Sticky CTA mobile — aparece cuando el botón principal sale del viewport
  const addBtn = document.getElementById('addToCartBtn');
  const stickyCta = document.getElementById('stickyCta');
  if (addBtn && stickyCta) {
    const obs = new IntersectionObserver(entries => {
      const visible = entries[0].isIntersecting;
      stickyCta.classList.toggle('show', !visible);
    }, { threshold: 0.5 });
    obs.observe(addBtn);
  }

  cargarProductos();
  initFadeUp();

  // Scroll header
  window.addEventListener('scroll', () => {
    document.getElementById('header').classList.toggle('scrolled', window.scrollY > 40);
  });

  // WA btn en producto
  document.getElementById('whatsappBtn').addEventListener('click', () => {
    const msg = currentProduct
      ? `Hola! Quiero consultar por *${currentProduct.nombre}* ($${currentProduct.precio?.toLocaleString('es-AR')})`
      : 'Hola! Quiero consultar sobre un producto';
    window.open(`https://wa.me/5493525614281?text=${encodeURIComponent(msg)}`, '_blank');
  });

  // Esc cierra modales
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') { closeSizeGuide(); closeImageModal(); }
  });

  // Toast clickeable → abre carrito
  document.getElementById('cartNotification').addEventListener('click', () => {
    document.getElementById('cartNotification').classList.remove('show');
    if (typeof toggleCart === 'function') toggleCart();
  });
});
</script>
</body>
</html>
