<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Producto · Bara & Co</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"/>
  <style>
    :root {
      --bg:      #0e0e0c;
      --surface: #161614;
      --border:  rgba(255,255,255,.07);
      --text:    #f0ece4;
      --muted:   #7a7872;
      --accent:  #c9a96e;
      --adk:     #9e7a3e;
      --red:     #b83030;
      --white:   #fff;
      --serif:   'Playfair Display', serif;
      --sans:    'Inter', sans-serif;
      --ease:    cubic-bezier(.16,1,.3,1);
    }
    
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background:var(--bg); color:var(--text);
      font-family:var(--sans); font-size:15px; line-height:1.6;
      padding-top:72px;
    }
    a { color:inherit; text-decoration:none; }
    img { display:block; width:100%; object-fit:cover; }
    
    /* Header */
    #header {
      position:fixed; top:0; left:0; right:0; z-index:200;
      display:flex; align-items:center; justify-content:space-between;
      padding:0 48px; height:72px;
      background:rgba(14,14,12,.93); backdrop-filter:blur(20px);
      border-bottom:1px solid var(--border);
    }
    .logo-img { height:56px; width:auto; object-fit:contain; display:block; }
    .header-nav ul { display:flex; gap:36px; }
    .header-nav a {
      font-size:11px; font-weight:500; letter-spacing:.12em; text-transform:uppercase;
      color:var(--muted); position:relative; transition:color .25s;
    }
    .header-nav a::after {
      content:''; position:absolute; bottom:-4px; left:0; right:0;
      height:1px; background:var(--accent);
      transform:scaleX(0); transform-origin:left; transition:transform .3s var(--ease);
    }
    .header-nav a:hover, .header-nav a.active { color:var(--text); }
    .header-nav a:hover::after, .header-nav a.active::after { transform:scaleX(1); }
    .header-icons { display:flex; align-items:center; gap:20px; }
    .header-icons i { font-size:16px; cursor:pointer; color:var(--muted); transition:color .25s; }
    .header-icons i:hover { color:var(--accent); }
    .cart-icon-wrap { position:relative; cursor:pointer; }
    .cart-badge {
      position:absolute; top:-7px; right:-9px;
      background:var(--accent); color:var(--bg);
      font-size:9px; font-weight:700; width:17px; height:17px;
      border-radius:50%; display:none; place-items:center;
    }
    .cart-badge.on { display:grid; }
    
    /* Breadcrumb */
    .breadcrumb {
      padding:24px 48px 0;
      font-size:12px; color:var(--muted);
    }
    .breadcrumb a { color:var(--muted); }
    .breadcrumb a:hover { color:var(--accent); }
    
    /* Página de producto */
    .product-page {
      display:grid; grid-template-columns:1fr 1fr;
      gap:40px; padding:40px 48px 80px;
      max-width:1400px; margin:0 auto;
    }
    
    /* Galería - CORREGIDA */
    .gallery {
      position: sticky;
      top: 100px;
      align-self: flex-start;
      height: fit-content;
    }
    
    .main-image {
      aspect-ratio: 3/4; 
      overflow: hidden; 
      border: 1px solid var(--border);
      margin-bottom: 16px; 
      cursor: zoom-in;
      background: var(--surface);
    }
    
    .main-image img {
      width: 100%; 
      height: 100%; 
      object-fit: cover;
      transition: transform .3s;
    }
    
    .main-image:hover img { 
      transform: scale(1.02); 
    }
    
    .thumbnails {
      display: flex; 
      gap: 8px; 
      overflow-x: auto; 
      padding-bottom: 8px;
      scrollbar-width: thin;
      scrollbar-color: var(--accent) var(--border);
    }
    
    .thumbnails::-webkit-scrollbar {
      height: 4px;
    }
    
    .thumbnails::-webkit-scrollbar-track {
      background: var(--border);
    }
    
    .thumbnails::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 4px;
    }
    
    .thumb {
      width: 80px; 
      height: 100px; 
      flex-shrink: 0;
      border: 1px solid var(--border); 
      cursor: pointer;
      transition: border-color .2s;
      background: var(--surface);
    }
    
    .thumb:hover, .thumb.active { 
      border-color: var(--accent); 
    }
    
    .thumb img { 
      width: 100%; 
      height: 100%; 
      object-fit: cover; 
    }
    
    /* Info producto */
    .product-info { 
      padding: 20px 0; 
      min-height: 800px; /* Para probar el scroll */
    }
    
    .product-category {
      font-size:10px; letter-spacing:.2em; text-transform:uppercase;
      color:var(--accent); margin-bottom:10px;
    }
    .product-title {
      font-family:var(--serif); font-size:42px; font-weight:400;
      margin-bottom:20px; line-height:1.1;
    }
    .product-price {
      font-size:32px; color:var(--accent); margin-bottom:20px;
    }
    .product-price del {
      font-size:20px; color:var(--muted); margin-right:10px;
    }
    .product-description {
      font-size:15px; color:var(--muted); line-height:1.8;
      margin-bottom:30px; padding-bottom:30px;
      border-bottom:1px solid var(--border);
    }
    
    /* Selector de talle */
    .size-label {
      font-size:12px; font-weight:600; letter-spacing:.1em;
      text-transform:uppercase; margin-bottom:12px;
    }
    .size-guide-link {
      float:right; font-size:11px; color:var(--accent);
      text-decoration:underline; cursor:pointer;
    }
    .size-options {
      display:flex; flex-wrap:wrap; gap:8px; margin-bottom:24px;
    }
    .size-btn {
      min-width:52px; padding:12px 18px;
      border:1px solid var(--border); background:none;
      color:var(--text); font-size:14px; cursor:pointer;
      transition:all .2s;
    }
    .size-btn:hover { border-color:var(--accent); }
    .size-btn.active {
      background:var(--accent); border-color:var(--accent); color:var(--bg);
    }
    .size-btn.out-of-stock {
      opacity:.3; cursor:not-allowed; text-decoration:line-through;
    }
    
    /* Selector de color */
    .color-label { font-size:12px; font-weight:600; letter-spacing:.1em; text-transform:uppercase; margin:20px 0 12px; }
    .color-options {
      display:flex; gap:10px; margin-bottom:30px;
    }
    .color-btn {
      width:36px; height:36px; border-radius:50%;
      border:2px solid transparent; cursor:pointer;
      transition:border-color .2s;
    }
    .color-btn:hover, .color-btn.active { border-color:var(--accent); }
    
    /* Botones de acción */
    .action-buttons {
      display:flex; gap:12px; margin-bottom:30px;
    }
    .btn {
      flex:1; padding:15px; border:none; cursor:pointer;
      font-family:var(--sans); font-size:12px; font-weight:600;
      letter-spacing:.15em; text-transform:uppercase;
      display:flex; align-items:center; justify-content:center; gap:8px;
      transition:all .2s;
    }
    .btn-primary {
      background:var(--accent); color:var(--bg);
    }
    .btn-primary:hover { background:var(--adk); }
    .btn-secondary {
      background:transparent; border:1px solid var(--border); color:var(--text);
    }
    .btn-secondary:hover { border-color:var(--accent); color:var(--accent); }
    
    /* Stock y envíos */
    .stock-info {
      display:flex; gap:24px; margin-bottom:30px;
      padding:20px; background:var(--surface); border:1px solid var(--border);
    }
    .stock-item {
      display:flex; align-items:center; gap:8px; font-size:13px;
    }
    .stock-item i { color:var(--accent); }
    
    /* Productos relacionados */
    .related {
      grid-column:1/-1;
      padding:60px 0 0;
      border-top:1px solid var(--border);
    }
    .related h3 {
      font-family:var(--serif); font-size:28px; font-weight:400;
      margin-bottom:30px;
    }
    .related-grid {
      display:grid; grid-template-columns:repeat(4,1fr); gap:2px;
    }
    .related-card {
      background:var(--surface); cursor:pointer; transition:transform .3s;
    }
    .related-card:hover { transform:translateY(-4px); }
    .related-card img {
      aspect-ratio:3/4; object-fit:cover; width:100%;
    }
    .related-info { padding:12px; }
    .related-name { font-size:14px; margin-bottom:4px; }
    .related-price { color:var(--accent); font-size:13px; }
    
    /* Modal imagen */
    .image-modal {
      position:fixed; inset:0; background:rgba(0,0,0,.95);
      z-index:1000; display:none; place-items:center;
    }
    .image-modal.open { display:grid; }
    .modal-img { max-width:90vw; max-height:90vh; }
    .modal-close {
      position:absolute; top:20px; right:20px;
      background:none; border:1px solid var(--border); color:var(--text);
      width:40px; height:40px; border-radius:50%; cursor:pointer;
      font-size:20px; transition:all .2s;
    }
    .modal-close:hover { border-color:var(--accent); color:var(--accent); }
    
    /* Cart drawer */
    .cart-backdrop {
      position:fixed; inset:0; background:rgba(0,0,0,.55);
      z-index:398; opacity:0; pointer-events:none; transition:opacity .3s;
    }
    .cart-backdrop.open { opacity:1; pointer-events:all; }
    .cart-drawer {
      position:fixed; top:0; right:0; bottom:0; width:min(400px,100vw);
      background:var(--surface); border-left:1px solid var(--border);
      z-index:399; display:flex; flex-direction:column;
      transform:translateX(101%); transition:transform .4s var(--ease);
    }
    .cart-drawer.open { transform:translateX(0); }
    .cd-head {
      padding:20px 22px; border-bottom:1px solid var(--border);
      display:flex; align-items:center; justify-content:space-between;
    }
    .cd-title { font-family:var(--serif); font-size:22px; font-weight:400; }
    .cd-close {
      background:none; border:1px solid var(--border); color:var(--text); cursor:pointer;
      width:32px; height:32px; border-radius:50%; display:grid; place-items:center;
      font-size:18px; transition:border-color .22s;
    }
    .cd-close:hover { border-color:var(--accent); }
    .cd-body { flex:1; overflow-y:auto; padding:16px 22px; }
    .cd-empty { text-align:center; padding:56px 0; color:var(--muted); font-size:13px; }
    .cd-item {
      display:flex; gap:12px; padding:12px 0; border-bottom:1px solid var(--border);
    }
    .cd-item-img { width:66px; height:80px; object-fit:cover; flex-shrink:0; }
    .cd-item-name  { font-family:var(--serif); font-size:15px; }
    .cd-item-size  { font-size:11px; color:var(--muted); margin-top:2px; }
    .cd-item-price { font-size:12px; color:var(--accent); margin-top:4px; }
    .cd-item-rm {
      background:none; border:none; color:var(--muted); font-size:17px;
      cursor:pointer; margin-left:auto; align-self:flex-start; transition:color .2s;
    }
    .cd-item-rm:hover { color:var(--red); }
    .cd-foot { padding:16px 22px; border-top:1px solid var(--border); }
    .cd-subtotal { display:flex; justify-content:space-between; margin-bottom:14px; font-size:13px; }
    .cd-subtotal span:last-child { font-family:var(--serif); font-size:19px; color:var(--accent); }
    .pay-btn {
      width:100%; padding:14px; border:none; cursor:pointer;
      font-family:var(--sans); font-size:10px; font-weight:700;
      letter-spacing:.18em; text-transform:uppercase;
      display:flex; align-items:center; justify-content:center; gap:8px;
      margin-bottom:9px; transition:background .22s;
    }
    .pay-mp { background:var(--accent); color:var(--bg); }
    .pay-mp:hover { background:var(--adk); }
    .pay-wa { background:#25d366; color:#fff; }
    .pay-wa:hover { background:#1dbd5c; }
    
    /* Toast */
    .cart-toast {
      position:fixed; bottom:28px; left:50%; transform:translateX(-50%) translateY(60px);
      background:var(--surface); border:1px solid var(--accent); color:var(--text);
      padding:12px 22px; font-size:13px; display:flex; align-items:center; gap:9px;
      z-index:600; opacity:0; white-space:nowrap; pointer-events:none;
      transition:transform .4s var(--ease), opacity .3s;
    }
    .cart-toast.show { transform:translateX(-50%) translateY(0); opacity:1; }
    .cart-toast i { color:var(--accent); }
    
    /* Guía de talles modal */
    .qv-backdrop {
      position:fixed; inset:0; background:rgba(0,0,0,.72);
      z-index:501; opacity:0; pointer-events:none; transition:opacity .3s;
    }
    .qv-backdrop.open { opacity:1; pointer-events:all; }
    .sg-modal {
      position:fixed; top:50%; left:50%; z-index:502;
      width:min(580px,96vw); max-height:90vh; overflow-y:auto;
      background:var(--surface); border:1px solid var(--border);
      transform:translate(-50%,-52%) scale(.97);
      opacity:0; pointer-events:none;
      transition:transform .35s var(--ease), opacity .3s;
      padding:32px 28px;
    }
    .sg-modal.open { transform:translate(-50%,-50%) scale(1); opacity:1; pointer-events:all; }
    .sg-modal h2 { font-family:var(--serif); font-size:24px; font-weight:400; margin-bottom:20px; }
    .sg-table { width:100%; border-collapse:collapse; font-size:13px; margin-bottom:20px; }
    .sg-table th { background:rgba(255,255,255,.05); padding:10px 14px; text-align:left; font-size:10px; letter-spacing:.1em; text-transform:uppercase; color:var(--muted); border-bottom:1px solid var(--border); }
    .sg-table td { padding:10px 14px; border-bottom:1px solid var(--border); }
    .sg-close { position:absolute; top:14px; right:16px; background:none; border:1px solid var(--border); color:var(--text); cursor:pointer; width:30px; height:30px; border-radius:50%; display:grid; place-items:center; font-size:16px; transition:border-color .2s; }
    .sg-close:hover { border-color:var(--accent); }
    
    /* Responsive */
    @media (max-width:900px) {
      #header { padding:0 22px; }
      .header-nav ul { display:none; }
      .product-page { 
        grid-template-columns:1fr; 
        padding:20px; 
        gap:20px;
      }
      .gallery { 
        position: relative; 
        top: 0;
        margin-bottom: 20px;
      }
      .related-grid { grid-template-columns:repeat(2,1fr); }
      .breadcrumb { padding:24px 22px 0; }
      .product-info { min-height: auto; }
    }
    @media (max-width:480px) {
      .product-title { font-size:32px; }
      .related-grid { grid-template-columns:1fr; }
      .action-buttons { flex-direction:column; }
      .stock-info { flex-direction:column; gap:12px; }
    }
  </style>
</head>
<body>

<header id="header">
  <a href="index.html"><img src="images/LogoB&D.png" alt="Bara & Co" class="logo-img"/></a>
  <nav class="header-nav">
    <ul>
      <li><a href="index.html">Inicio</a></li>
      <li><a href="tienda.html" class="active">Tienda</a></li>
      <li><a href="lookbook.html">Lookbook</a></li>
      <li><a href="contacto.html">Contacto</a></li>
    </ul>
  </nav>
  <div class="header-icons">
    <i class="fas fa-search" onclick="window.location.href='tienda.html'"></i>
    <div class="cart-icon-wrap" onclick="toggleCart()">
      <i class="fas fa-shopping-bag"></i>
      <span class="cart-badge" id="cartBadge">0</span>
    </div>
  </div>
</header>

<!-- Breadcrumb -->
<div class="breadcrumb">
  <a href="index.html">Inicio</a> / <a href="tienda.html">Tienda</a> / <span id="breadcrumbCat"></span> / <span id="breadcrumbName"></span>
</div>

<!-- Página de producto -->
<div class="product-page">
  <!-- Galería -->
  <div class="gallery">
    <div class="main-image" id="mainImage" onclick="openImageModal()">
      <img src="" alt="" id="currentImage" style="width:100%; height:100%; object-fit:cover;"/>
    </div>
    <div class="thumbnails" id="thumbnails"></div>
  </div>
  
  <!-- Info producto -->
  <div class="product-info">
    <p class="product-category" id="productCategory"></p>
    <h1 class="product-title" id="productName"></h1>
    <div class="product-price" id="productPrice"></div>
    <p class="product-description" id="productDescription"></p>
    
    <!-- Selector de talle -->
    <div class="size-label">
      TALLE
      <span class="size-guide-link" onclick="openSizeGuide()">Guía de talles</span>
    </div>
    <div class="size-options" id="sizeOptions"></div>
    
    <!-- Selector de color -->
    <div id="colorSection" style="display:none;">
      <div class="color-label">COLOR</div>
      <div class="color-options" id="colorOptions"></div>
    </div>
    
    <!-- Botones -->
    <div class="action-buttons">
      <button class="btn btn-primary" id="addToCartBtn">
        <i class="fas fa-shopping-bag"></i> AGREGAR AL CARRITO
      </button>
      <button class="btn btn-secondary" id="whatsappBtn">
        <i class="fab fa-whatsapp"></i> CONSULTAR
      </button>
    </div>
    
    <!-- Stock info -->
    <div class="stock-info">
      <div class="stock-item"><i class="fas fa-truck"></i> Envío gratis +$80.000</div>
      <div class="stock-item"><i class="fas fa-undo-alt"></i> Cambios y devoluciones</div>
      <div class="stock-item"><i class="fas fa-shield-alt"></i> Compra segura</div>
    </div>
    
    <!-- Texto adicional para probar scroll -->
    <div style="margin-top:40px; padding-top:40px; border-top:1px solid var(--border);">
      <h3 style="font-family:var(--serif); margin-bottom:20px;">Características</h3>
      <p style="color:var(--muted); line-height:1.8;">• Diseño exclusivo Bara & Co<br/>• Alta calidad en materiales<br/>• Confort y durabilidad<br/>• Lavar a máquina max. 30°C<br/>• No usar blanqueador<br/>• Planchar a baja temperatura</p>
    </div>
  </div>
  
  <!-- Productos relacionados -->
  <div class="related">
    <h3>También te puede gustar</h3>
    <div class="related-grid" id="relatedProducts"></div>
  </div>
</div>

<!-- Modal imagen ampliada -->
<div class="image-modal" id="imageModal" onclick="closeImageModal()">
  <button class="modal-close">×</button>
  <img src="" alt="" class="modal-img" id="modalImage"/>
</div>

<!-- Guía de talles modal -->
<div class="qv-backdrop" id="sgBackdrop" onclick="closeSizeGuide()"></div>
<div class="sg-modal" id="sgModal">
  <button class="sg-close" onclick="closeSizeGuide()">×</button>
  <h2>Guía de Talles</h2>
  <h4 style="font-size:11px;letter-spacing:.15em;text-transform:uppercase;color:var(--muted);margin-bottom:12px;">Ropa Hombre</h4>
  <table class="sg-table">
    <thead><tr><th>Talle</th><th>Pecho (cm)</th><th>Cintura (cm)</th><th>Cadera (cm)</th></tr></thead>
    <tbody>
      <tr><td>S</td><td>88–92</td><td>74–78</td><td>88–92</td></tr>
      <tr><td>M</td><td>93–98</td><td>79–84</td><td>93–98</td></tr>
      <tr><td>L</td><td>99–104</td><td>85–90</td><td>99–104</td></tr>
      <tr><td>XL</td><td>105–112</td><td>91–98</td><td>105–112</td></tr>
    </tbody>
  </table>
  <h4 style="font-size:11px;letter-spacing:.15em;text-transform:uppercase;color:var(--muted);margin-bottom:12px;">Ropa Mujer</h4>
  <table class="sg-table">
    <thead><tr><th>Talle</th><th>Pecho (cm)</th><th>Cintura (cm)</th><th>Cadera (cm)</th></tr></thead>
    <tbody>
      <tr><td>XS</td><td>80–84</td><td>62–66</td><td>84–88</td></tr>
      <tr><td>S</td><td>85–88</td><td>67–70</td><td>89–92</td></tr>
      <tr><td>M</td><td>89–93</td><td>71–75</td><td>93–97</td></tr>
      <tr><td>L</td><td>94–99</td><td>76–81</td><td>98–103</td></tr>
    </tbody>
  </table>
</div>

<!-- Cart drawer -->
<div class="cart-backdrop" id="cartBackdrop" onclick="toggleCart()"></div>
<div class="cart-drawer" id="cartDrawer">
  <div class="cd-head">
    <h2 class="cd-title">Carrito</h2>
    <button class="cd-close" onclick="toggleCart()">×</button>
  </div>
  <div class="cd-body" id="cdBody">
    <div class="cd-empty" id="cdEmpty">Tu carrito está vacío</div>
  </div>
  <div class="cd-foot">
    <div class="cd-subtotal"><span>Subtotal</span><span id="cdTotal">$0</span></div>
    <button class="pay-btn pay-mp" onclick="pagarMP()">
      <i class="fab fa-cc-visa"></i> Pagar con MercadoPago
    </button>
    <button class="pay-btn pay-wa" onclick="pagarWA()">
      <i class="fab fa-whatsapp"></i> Solicitar por WhatsApp
    </button>
    <p class="pay-info"><i class="fas fa-lock"></i> Pago seguro</p>
  </div>
</div>

<!-- Toast -->
<div class="cart-toast" id="cartToast"><i class="fas fa-check-circle"></i> Producto agregado al carrito</div>

<script>
// ========== VARIABLES GLOBALES ==========
let productos = [];
let currentProduct = null;
let selectedSize = null;
let selectedColor = null;
let cart = JSON.parse(localStorage.getItem('bc_cart') || '[]');

// Obtener ID del producto de la URL
const urlParams = new URLSearchParams(window.location.search);
const productId = urlParams.get('id');

// ========== CARGAR PRODUCTOS ==========
async function cargarProductos() {
  try {
    const response = await fetch('productos.json?t=' + Date.now());
    if (!response.ok) throw new Error('No se pudo cargar productos.json');
    productos = await response.json();
    
    // Buscar producto actual
    currentProduct = productos.find(p => p.id === productId && p.activo !== false);
    
    if (!currentProduct) {
      // Producto no encontrado, redirigir a tienda
      window.location.href = 'tienda.html';
      return;
    }
    
    renderizarProducto();
    cargarRelacionados();
    
  } catch (error) {
    console.error('Error:', error);
    window.location.href = 'tienda.html';
  }
}

// ========== RENDERIZAR PRODUCTO ==========
function renderizarProducto() {
  // Breadcrumb
  document.getElementById('breadcrumbCat').textContent = currentProduct.categoria;
  document.getElementById('breadcrumbName').textContent = currentProduct.nombre;
  
  // Imágenes
  const imagenes = currentProduct.imagenes || [currentProduct.imagen];
  document.getElementById('currentImage').src = imagenes[0];
  document.getElementById('currentImage').alt = currentProduct.nombre;
  
  // Thumbnails
  const thumbs = document.getElementById('thumbnails');
  thumbs.innerHTML = '';
  imagenes.forEach((img, index) => {
    const thumb = document.createElement('div');
    thumb.className = 'thumb' + (index === 0 ? ' active' : '');
    thumb.innerHTML = `<img src="${img}" alt="${currentProduct.nombre}" onclick="cambiarImagen(${index})">`;
    thumbs.appendChild(thumb);
  });
  
  // Info básica
  document.getElementById('productCategory').textContent = 
    `${currentProduct.categoria} · ${currentProduct.subcategoria || ''}`;
  document.getElementById('productName').textContent = currentProduct.nombre;
  
  // Precio
  const priceEl = document.getElementById('productPrice');
  if (currentProduct.precioAnterior) {
    const descuento = Math.round((1 - currentProduct.precio / currentProduct.precioAnterior) * 100);
    priceEl.innerHTML = `
      <del>$${currentProduct.precioAnterior.toLocaleString('es-AR')}</del> 
      $${currentProduct.precio.toLocaleString('es-AR')}
      <span style="background:var(--red);color:#fff;font-size:14px;padding:3px 8px;margin-left:10px;">-${descuento}%</span>
    `;
  } else {
    priceEl.textContent = '$' + currentProduct.precio.toLocaleString('es-AR');
  }
  
  // Descripción
  document.getElementById('productDescription').textContent = 
    currentProduct.descripcion || 'Prenda de alta calidad, diseño exclusivo Bara & Co. Consultá disponibilidad de talles.';
  
  // Talles
  const talles = currentProduct.tallesDisponibles || currentProduct.talles || [];
  const sizeOptions = document.getElementById('sizeOptions');
  sizeOptions.innerHTML = '';
  
  talles.forEach(talle => {
    const btn = document.createElement('button');
    btn.className = 'size-btn';
    btn.textContent = talle;
    btn.onclick = () => seleccionarTalle(talle, btn);
    sizeOptions.appendChild(btn);
  });
  
  // Colores (si existen)
  if (currentProduct.colores && currentProduct.colores.length > 0) {
    document.getElementById('colorSection').style.display = 'block';
    const colorOptions = document.getElementById('colorOptions');
    colorOptions.innerHTML = '';
    
    currentProduct.colores.forEach((color, index) => {
      const btn = document.createElement('button');
      btn.className = 'color-btn';
      btn.style.backgroundColor = getColorCode(color);
      btn.title = color;
      btn.onclick = () => seleccionarColor(color, btn);
      colorOptions.appendChild(btn);
    });
  }
}

// ========== FUNCIONES DE INTERACCIÓN ==========
function cambiarImagen(index) {
  const imagenes = currentProduct.imagenes || [currentProduct.imagen];
  document.getElementById('currentImage').src = imagenes[index];
  
  // Actualizar active en thumbnails
  document.querySelectorAll('.thumb').forEach((thumb, i) => {
    thumb.classList.toggle('active', i === index);
  });
}

function seleccionarTalle(talle, btn) {
  document.querySelectorAll('.size-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  selectedSize = talle;
}

function seleccionarColor(color, btn) {
  document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  selectedColor = color;
}

function getColorCode(color) {
  const colores = {
    'Negro': '#000000',
    'Blanco': '#FFFFFF',
    'Azul': '#0066cc',
    'Rojo': '#cc0000',
    'Verde': '#00cc66',
    'Amarillo': '#ffcc00',
    'Gris': '#808080',
    'Beige': '#f5f5dc',
    'Camel': '#c19a6b',
    'Mostaza': '#ffdb58',
    'Lila': '#c8a2c8',
    'Fucsia': '#ff00ff',
    'Arena': '#f4e9d8',
    'Multicolor': 'linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet)'
  };
  return colores[color] || '#cccccc';
}

// ========== AGREGAR AL CARRITO ==========
function agregarAlCarrito() {
  // Verificar que se haya seleccionado talle (si aplica)
  const talles = currentProduct.tallesDisponibles || currentProduct.talles || [];
  if (talles.length > 0 && talles[0] !== 'Unico' && !selectedSize) {
    alert('Por favor seleccioná un talle');
    return;
  }
  
  const item = {
    id: currentProduct.id,
    nombre: currentProduct.nombre,
    precio: currentProduct.precio,
    talle: selectedSize || talles[0] || 'Único',
    color: selectedColor || null,
    imagen: currentProduct.imagen,
    qty: 1
  };
  
  // Buscar si ya existe en carrito (mismo producto y mismo talle)
  const existing = cart.find(i => i.id === item.id && i.talle === item.talle);
  if (existing) {
    existing.qty++;
  } else {
    cart.push(item);
  }
  
  saveCart();
  toggleCart();
  showToast();
}

// ========== FUNCIONES DE CARRITO ==========
function saveCart() { 
  localStorage.setItem('bc_cart', JSON.stringify(cart)); 
  renderCart();
}

function toggleCart() {
  document.getElementById('cartDrawer').classList.toggle('open');
  document.getElementById('cartBackdrop').classList.toggle('open');
}

function renderCart() {
  const body = document.getElementById('cdBody');
  const empty = document.getElementById('cdEmpty');
  const badge = document.getElementById('cartBadge');
  const totalEl = document.getElementById('cdTotal');
  
  const cnt = cart.reduce((s,i) => s + i.qty, 0);
  const sum = cart.reduce((s,i) => s + i.precio * i.qty, 0);
  
  badge.textContent = cnt;
  badge.classList.toggle('on', cnt > 0);
  totalEl.textContent = '$' + sum.toLocaleString('es-AR');
  
  // Limpiar items anteriores
  document.querySelectorAll('.cd-item').forEach(el => el.remove());
  
  empty.style.display = cart.length ? 'none' : 'block';
  
  cart.forEach(item => {
    const el = document.createElement('div');
    el.className = 'cd-item';
    el.innerHTML = `
      <img class="cd-item-img" src="${item.imagen}" alt="${item.nombre}"/>
      <div style="flex:1">
        <div class="cd-item-name">${item.nombre}</div>
        <div class="cd-item-size">Talle: ${item.talle}</div>
        <div class="cd-item-price">$${(item.precio * item.qty).toLocaleString('es-AR')}</div>
        <div style="font-size:11px;color:var(--muted);margin-top:4px;">Cant: ${item.qty}</div>
      </div>
      <button class="cd-item-rm" onclick="eliminarDelCarrito('${item.id}', '${item.talle}')">×</button>
    `;
    body.appendChild(el);
  });
}

function eliminarDelCarrito(id, talle) {
  cart = cart.filter(i => !(i.id === id && i.talle === talle));
  saveCart();
}

function showToast() {
  const t = document.getElementById('cartToast');
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2400);
}

function pagarWA() {
  if (!cart.length) return;
  const lines = cart.map(i => `• ${i.nombre} (Talle ${i.talle})${i.qty > 1 ? ' x' + i.qty : ''} — $${(i.precio * i.qty).toLocaleString('es-AR')}`).join('%0A');
  const total = cart.reduce((s,i) => s + i.precio * i.qty, 0);
  window.open(`https://wa.me/5493525614281?text=Hola!%20Quiero%20hacer%20el%20siguiente%20pedido:%0A${lines}%0A%0ATotal:%20$${total.toLocaleString('es-AR')}`, '_blank');
}

function pagarMP() {
  if (!cart.length) return;
  const total = cart.reduce((s,i) => s + i.precio * i.qty, 0);
  window.open(`https://link.mercadopago.com.ar/baraandco?amount=${total}`, '_blank');
}

// ========== PRODUCTOS RELACIONADOS ==========
function cargarRelacionados() {
  const relacionados = productos
    .filter(p => p.categoria === currentProduct.categoria && p.id !== currentProduct.id)
    .slice(0, 4);
  
  const grid = document.getElementById('relatedProducts');
  grid.innerHTML = '';
  
  relacionados.forEach(p => {
    const card = document.createElement('div');
    card.className = 'related-card';
    card.onclick = () => window.location.href = `producto.html?id=${p.id}`;
    card.innerHTML = `
      <img src="${p.imagen}" alt="${p.nombre}"/>
      <div class="related-info">
        <div class="related-name">${p.nombre}</div>
        <div class="related-price">$${p.precio.toLocaleString('es-AR')}</div>
      </div>
    `;
    grid.appendChild(card);
  });
}

// ========== MODAL IMAGEN ==========
function openImageModal() {
  document.getElementById('imageModal').classList.add('open');
  document.getElementById('modalImage').src = document.getElementById('currentImage').src;
}

function closeImageModal() {
  document.getElementById('imageModal').classList.remove('open');
}

// ========== GUÍA DE TALLES ==========
function openSizeGuide() {
  document.getElementById('sgModal').classList.add('open');
  document.getElementById('sgBackdrop').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeSizeGuide() {
  document.getElementById('sgModal').classList.remove('open');
  document.getElementById('sgBackdrop').classList.remove('open');
  document.body.style.overflow = '';
}

// ========== INICIALIZACIÓN ==========
document.addEventListener('DOMContentLoaded', () => {
  cargarProductos();
  renderCart();
  
  document.getElementById('addToCartBtn').addEventListener('click', agregarAlCarrito);
  document.getElementById('whatsappBtn').addEventListener('click', () => {
    const msg = `Hola! Quiero consultar por *${currentProduct?.nombre}*`;
    window.open(`https://wa.me/5493525614281?text=${encodeURIComponent(msg)}`, '_blank');
  });
  
  // Cerrar modales con Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeSizeGuide();
      closeImageModal();
      if (document.getElementById('cartDrawer').classList.contains('open')) {
        toggleCart();
      }
    }
  });
});
</script>
</body>
</html>
